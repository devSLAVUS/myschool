# DevOps case by Slavus
###### Репозиторий подготовлен для теста: https://events.webinar.ru/course-info/66147
## Для запуска приложения понадобится:  
* Две виртуальные машины с системами debian или ubuntu актуальных версий, на момент публикации это debian 11 и ubuntu 21
1. Первая VM выступает в роли jenkins-сервера, на нее необходимо установить:
    1. git
    1. curl
    1. docker-ce
    1. openjdk-11
    1. jenkins с установкой рекомендуемых плагинов
1. На вторую VM выступающую в роли клиента требуется установить систему и открыть ssh доступ для пользователя root
1. Далее на сервере-jenkins необходимо:
    1. Добавить пользователя jenkins в группу docker.
    1. Сгенерировать ssh-ключ для пользователя jenkins и открытую часть разместить на клиенсткой VM для пользователя root.
    1. На сервере-jenkins в /etc/hosts пропишите DNS имя для ip-адреса VM-клиента как "prodstage"
    1. Перезагрузите сервер-jenkins и проверьте что из под пользователя jenkins работают команды docker, а так же что по команде `ssh root@prodstage`  вы попадаете на VM-клиента без ввода пароля
 1. Для отправки docker образа в dockerhub в настройках jenkins'a необходимо добавить учетные данные от dockerhub репозитория
## Структура:  
* Простое веб приложение написанное на python размещено: `django_school/`
* Jenkins-скрипт и вспомогательные скрипты: `tool/`  
## Используемые плагины jenkins  
К стандартным рекомендованым плагинам jenkins'a версии 2.303.3 дополнительно установлены:  
* Cobertura Plugin - для проверки покрытия кода
* Email Extension Plugin - для отправки уведомлений на почту
* HTML Publisher plugin - для создания отчета о безопасности образа
## Запуск задачи jenkins
1. Для запуска задачи необходимо создать новый item, тип pipline  
1. Указать репозиторий, в моем случае https://github.com/devSLAVUS/myschool.git
1. Указать учетные данные, если репозиторий приватный
1. Указать ветку `*/master`
1. Путь к скрипту `tool/Jenkinsfile.jenkins`
## Отправка писем  
Скрипт умеет отпралять письма на почту.    
Для этого необходимо в настройках системы jenkins'a в пунктах *Extended E-mail Notification* и *Уведомление почтой*
прописать настройки вашего smtp сервера, я использовал сервер яндекса.  
Письма будут отправлены на почту пользователя инициировавшего выполнение задачи в jenkins'е, она должна быть указана в настройках учетной записи.

###### Последнее обновление: 06.11.2021
